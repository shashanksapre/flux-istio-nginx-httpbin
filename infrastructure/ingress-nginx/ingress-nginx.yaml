apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ingress-nginx
  labels:
    app: "ingress-nginx"
    version: "0.1"
    app.kubernetes.io/name: "ingress-nginx"
    app.kubernetes.io/version: "0.1"
spec:
  releaseName: ingress-nginx
  # chart:
  #   spec:
  #     chart: ./charts/ingress-nginx
  #     sourceRef:
  #       kind: GitRepository
  #       name: ingress-nginx
  #       namespace: flux-system
  chart:
    spec:
      chart: ingress-nginx
      sourceRef:
        kind: HelmRepository
        name: ingress-nginx
        namespace: flux-system
      interval: 1m
  dependsOn:
  - name: istio-discovery
    namespace: istio-system
  interval: 5m
  values:
    controller:
      # labels:
      #   app: "ingress-nginx"
      #   version: "0.1"
      podLabels:
        app.kubernetes.io/name: "ingress-nginx-controller"
        app.kubernetes.io/component: "controller"
        app.kubernetes.io/instance: "ingress-nginx"
        app: "ingress-nginx-controller"
        app.kubernetes.io/managed-by: "Helm"
        app.kubernetes.io/version: "0.48.1"
        helm.sh/chart: "ingress-nginx-3.35.0"
        helm.toolkit.fluxcd.io/name: "ingress-nginx"
        helm.toolkit.fluxcd.io/namespace: "default"
        version: "0.1"
      ingressClass: nginx
      podAnnotations:
        # Do not redirect inbound traffic to Envoy.
        traffic.sidecar.istio.io/includeInboundPorts: ""
        traffic.sidecar.istio.io/excludeInboundPorts: "80,443"
        # Exclude outbound traffic to kubernetes master from redirection.
        traffic.sidecar.istio.io/excludeOutboundIPRanges: "10.96.0.1/32"
        # sidecar.istio.io/inject: "true"
      admissionWebhooks:
        patch:
          podAnnotations:
            sidecar.istio.io/inject: "false"
      replicaCount: 1
      service:
        # labels:
        #   app: "ingress-nginx"
        #   version: "0.1"
        enabled: true
        annotations:
          service.beta.kubernetes.io/aws-load-balancer-type: nlb